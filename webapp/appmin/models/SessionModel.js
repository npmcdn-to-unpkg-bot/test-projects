define(["app","models/UserModel","utils"],function(e,t){var n=Backbone.Model.extend({defaults:{logged_in:!1,user_id:""},initialize:function(){_.bindAll(this),this.user=new t({})},url:function(){return e.API+"/login"},updateSessionUser:function(e){this.user.set(_.pick(e,_.keys(this.user.defaults)))},checkAuth:function(e,t){var n=this;this.fetch({cache:!1,success:function(t,r){!r.error&&r.user&&r.user.authenticated?(n.updateSessionUser(r.user),n.set({logged_in:!0}),"success"in e&&e.success(t,r)):(console.log("Setting logged in to false1. Else"),n.set({logged_in:!1}),"error"in e&&e.error(t,r))},error:function(t,r){console.log("Setting logged in to false. Error"),n.set({logged_in:!1}),"error"in e&&e.error(t,r)}}).complete(function(){"complete"in e&&e.complete()})},postAuth:function(e,t,n){var r=this,i=navigator.appName+" "+navigator.appCodeName+" "+navigator.appVersion,s=navigator.platform;_.extend(e,{browser_type:i,device_type:s});var o=_.omit(e,"method");$.ajax({url:this.url(),contentType:"application/json",dataType:"json",type:"POST",beforeSend:function(e){},data:JSON.stringify(e),success:function(n){!n.error&&n.user.authenticated===!0?(_.indexOf(["login","signup"],e.method)!==-1?(r.updateSessionUser(n.user||{}),r.set({user_id:n.user.id,logged_in:!0})):(console.log("Setting logged in to false"),r.set({logged_in:!1})),t&&"success"in t&&t.success(n)):!n.error&&!n.user.authenticated?(_.indexOf(["logout"],e.method)!==-1&&(r.set({user_id:null,logged_in:!1}),t&&"success"in t&&t.success(n)),t&&"error"in t&&t.error(n)):t&&"error"in t&&t.error(n)},error:function(e,n){t&&"error"in t&&t.error(n)}}).complete(function(){t&&"complete"in t&&t.complete(res)})},login:function(e,t,n){this.postAuth(_.extend(e,{method:"login"}),t)},logout:function(e,t,n){this.postAuth(_.extend(e,{method:"logout"}),t)}});return n});